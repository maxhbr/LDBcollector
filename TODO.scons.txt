# Download rdfhdt from http://www.rdfhdt.org/download/ and then place a
# link to rdf2hdt in bin, e.g.:
#     ln -s ~/code/3rdparty/hdt-it/trunk/hdt-lib/tools/rdf2hdt bin/
RDF2HDT := bin/rdf2hdt

TODAY = `date +"%Y-%m-%d"`
HTML_TARGETS = $(patsubst %.ttl,%.html,$(wildcard www/id/*.ttl))
JSONLD_TARGETS = $(patsubst %.ttl,%.jsonld,$(wildcard www/id/*.ttl))

WEB_SOURCES = index.html license.html ns.html
WEB_VERBATIM = licensedb.css favicon.ico licensedb.png
WEB_TARGETS := $(addprefix www/,$(WEB_SOURCES) $(WEB_VERBATIM))
JS_TARGETS = www/js/nprogress.js www/js/app.js www/nprogress.css

all: $(TXT_TARGETS) $(JS_TARGETS) cc publish dataset jsonld html website

js: $(JS_TARGETS)

jsonld: $(JSON_TARGETS) $(JSONLD_TARGETS) vocab

html: $(HTML_TARGETS) $(JSONLD_TARGETS)

website: $(WEB_TARGETS) | www
	@echo Generating id/index.html web page
	@php src/site/page.php src/site/id.php "../" > www/id/index.html

www/id/%.html: www/id/%.jsonld data/context.jsonld src/site/license-page.php src/site/metadata.php
	@echo Serializing to $@
	@php src/site/license-page.php $< > $@

www/%.html: src/site/%.html src/site/page.php vocab | www
	@echo Generating $@ web page
	@php src/site/page.php $< "" > $@

www/favicon.ico: src/site/favicon.ico | www; @cp $< $@
www/licensedb.png: src/site/licensedb.png | www; @cp $< $@
www/licensedb.css: src/site/licensedb.css | www; @cp $< $@
www/nprogress.css: node_modules/nprogress/nprogress.css | www; @cp $< $@
www/js/nprogress.js: node_modules/nprogress/nprogress.js | www; @cp $< $@

www/js/app.js: src/app.jsx src/license.jsx src/prefixes.jsx
	node_modules/.bin/webpack -p -d --progress --colors --display-error-details

clean:
	rm -rf www

# Local Variables:
# mode: makefile
# End:

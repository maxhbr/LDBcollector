#  SPDX-FileCopyrightText: 2021 Hermine-team <hermine@inno3.fr>
#
#  SPDX-License-Identifier: AGPL-3.0-only
from django.db import migrations, models


def update_exploitation_values_forward(apps, schema_editor):
    Usage = apps.get_model("cube", "Usage")
    db_alias = schema_editor.connection.alias
    Usage.objects.using(db_alias).filter(exploitation="Distribution").update(
        exploitation="DistributionSourceDistributionNonSource"
    )

    Obligation = apps.get_model("cube", "Obligation")
    Obligation.objects.using(db_alias).filter(trigger_expl="Distribution").update(
        trigger_expl="DistributionSourceDistributionNonSource"
    )


def update_exploitation_values_backward(apps, schema_editor):
    Usage = apps.get_model("cube", "Usage")
    db_alias = schema_editor.connection.alias
    Usage.objects.using(db_alias).filter(
        exploitation="DistributionSourceDistributionNonSource"
    ).update(exploitation="Distribution")

    Obligation = apps.get_model("cube", "Obligation")
    Obligation.objects.using(db_alias).filter(
        trigger_expl="DistributionSourceDistributionNonSource"
    ).update(trigger_expl="Distribution")


class Migration(migrations.Migration):
    dependencies = [("cube", "0001_initial")]

    operations = [
        migrations.AlterField(
            model_name="obligation",
            name="trigger_expl",
            field=models.CharField(
                choices=[
                    (
                        "DistributionSourceDistributionNonSource",
                        "Distribution Source or Object",
                    ),
                    ("DistributionSource", "Distribution of Source Code"),
                    ("DistributionNonSource", "Distribution Non Source"),
                    ("NetworkAccess", "Network Access"),
                    ("InternalUse", "Internal Use"),
                ],
                default="DistributionSourceDistributionNonSource",
                max_length=40,
            ),
        ),
        migrations.AlterField(
            model_name="usage",
            name="exploitation",
            field=models.CharField(
                choices=[
                    (
                        "DistributionSourceDistributionNonSource",
                        "Distribution source and object",
                    ),
                    ("DistributionSource", "Distribution - Source"),
                    ("DistributionNonSource", "Distribution Non source"),
                    ("NetworkAccess", "Network access"),
                    ("InternalUse", "Internal use"),
                ],
                default="DistributionSourceDistributionNonSource",
                max_length=50,
            ),
        ),
        migrations.RunPython(
            update_exploitation_values_forward, update_exploitation_values_backward
        ),
    ]

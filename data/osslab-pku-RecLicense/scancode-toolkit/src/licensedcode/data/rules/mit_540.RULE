This patch is provided under the MIT licence.
This code is a port of the public domain implementation
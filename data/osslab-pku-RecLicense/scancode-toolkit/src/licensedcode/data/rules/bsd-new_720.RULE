/* This code is originally from Tor.  Used with permission. */
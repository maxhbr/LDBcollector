name: Update Documentation Version

on:
  push:
    tags:
      - 'v[0-9]+.[0-9]+.[0-9]+'

jobs:
  update-version:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          token: ${{secrets.PUSH_TOKEN}}
          ref: main
          fetch-depth: 0

      - name: Extract version from tag
        id: version
        run: |
          # Get tag name and strip 'v' prefix
          TAG_NAME="${{ github.ref_name }}"
          VERSION="${TAG_NAME#v}"
          echo "version=$VERSION" >> $GITHUB_OUTPUT
          echo "Extracted version: $VERSION"

      - name: Update Java README.md
        run: |
          VERSION="${{ steps.version.outputs.version }}"
          # Update Gradle groovy syntax (matches with or without 'v' prefix)
          sed -i "s/implementation 'org\.licenselynx:licenselynx:v\?[0-9]\+\.[0-9]\+\.[0-9]\+'/implementation 'org.licenselynx:licenselynx:$VERSION'/g" java/README.md
          # Update Gradle Kotlin DSL syntax (matches with or without 'v' prefix)
          sed -i "s/implementation(\"org\.licenselynx:licenselynx:v\?[0-9]\+\.[0-9]\+\.[0-9]\+\")/implementation(\"org.licenselynx:licenselynx:$VERSION\")/g" java/README.md
          # Update Maven XML version tag (matches with or without 'v' prefix)
          sed -i "s/<version>v\?[0-9]\+\.[0-9]\+\.[0-9]\+<\/version>/<version>$VERSION<\/version>/g" java/README.md

      - name: Update website installation.md
        run: |
          VERSION="${{ steps.version.outputs.version }}"
          # Update Gradle groovy syntax (matches with or without 'v' prefix)
          sed -i "s/implementation 'org\.licenselynx:licenselynx:v\?[0-9]\+\.[0-9]\+\.[0-9]\+'/implementation 'org.licenselynx:licenselynx:$VERSION'/g" website/docs/installation.md
          # Update Maven XML version tag (matches with or without 'v' prefix)
          sed -i "s/<version>v\?[0-9]\+\.[0-9]\+\.[0-9]\+<\/version>/<version>$VERSION<\/version>/g" website/docs/installation.md

      - name: Commit and push changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "docs: update Java library version to ${{ steps.version.outputs.version }}"
          branch: main
          file_pattern: 'java/README.md website/docs/installation.md'
